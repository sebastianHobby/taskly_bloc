bucket_definitions:

  user_core:
    priority: 1
    parameters:
      - SELECT request.user_id() as user_id

    data:
      # Tasks
      - SELECT * FROM tasks WHERE user_id = bucket.user_id

      # Projects
      - SELECT * FROM projects WHERE user_id = bucket.user_id

      # Values
      - SELECT * FROM values WHERE user_id = bucket.user_id

      # User settings
      - SELECT * FROM user_profiles WHERE user_id = bucket.user_id

      # My Day picks (persisted ritual selection)
      - SELECT * FROM my_day_days WHERE user_id = bucket.user_id
      - SELECT * FROM my_day_picks WHERE user_id = bucket.user_id

      # Project anchor state (last anchored time)
      - SELECT * FROM project_anchor_state WHERE user_id = bucket.user_id

      # Routines (weekly/monthly)
      - SELECT * FROM routines WHERE user_id = bucket.user_id

      # Checklist definitions + live state
      - SELECT * FROM task_checklist_items WHERE user_id = bucket.user_id
      - SELECT * FROM task_checklist_item_state WHERE user_id = bucket.user_id
      - SELECT * FROM routine_checklist_items WHERE user_id = bucket.user_id
      - SELECT * FROM routine_checklist_item_state WHERE user_id = bucket.user_id



      # Pending Notifications
      - SELECT * FROM pending_notifications WHERE user_id = bucket.user_id

      # Attention Rules (with UUID PK - clean sync)
      - SELECT * FROM attention_rules WHERE user_id = bucket.user_id

      # Attention Rule Runtime State (per-rule/per-entity evaluation state)
      - SELECT * FROM attention_rule_runtime_state WHERE user_id = bucket.user_id


  user_history:
    priority: 2
    parameters:
      - SELECT request.user_id() as user_id

    data:
      # Task Completion History
      - SELECT * FROM task_completion_history WHERE user_id = bucket.user_id

      # Task Snooze Events
      - SELECT * FROM task_snooze_events WHERE user_id = bucket.user_id

      # Routine Completions
      - SELECT * FROM routine_completions WHERE user_id = bucket.user_id

      # Routine Skips (week/month)
      - SELECT * FROM routine_skips WHERE user_id = bucket.user_id

      # Weekly Value Ratings
      - SELECT * FROM value_ratings_weekly WHERE user_id = bucket.user_id

      # Project Completion History
      - SELECT * FROM project_completion_history WHERE user_id = bucket.user_id

      # Task Recurrence Exceptions
      - SELECT * FROM task_recurrence_exceptions WHERE user_id = bucket.user_id

      # Project Recurrence Exceptions
      - SELECT * FROM project_recurrence_exceptions WHERE user_id = bucket.user_id

      # Attention Resolutions (with UUID PK - clean sync)
      - SELECT * FROM attention_resolutions WHERE user_id = bucket.user_id

      # Analytics Snapshots
      - SELECT * FROM analytics_snapshots WHERE user_id = bucket.user_id

      # Analytics Correlations
      - SELECT * FROM analytics_correlations WHERE user_id = bucket.user_id

      # Analytics Insights
      - SELECT * FROM analytics_insights WHERE user_id = bucket.user_id

      # Journal Entries
      - SELECT * FROM journal_entries WHERE user_id = bucket.user_id

      # Tracker Groups (user-defined organizational groups)
      - SELECT * FROM tracker_groups WHERE user_id = bucket.user_id

      # Tracker Definitions (replaces trackers)
      - SELECT * FROM tracker_definitions WHERE user_id = bucket.user_id

      # Tracker Preferences (per-user ordering/visibility/pinning)
      - SELECT * FROM tracker_preferences WHERE user_id = bucket.user_id

      # Tracker Definition Choices (optional: normalized options for choice trackers)
      - SELECT * FROM tracker_definition_choices WHERE user_id = bucket.user_id

      # Tracker Events (replaces tracker_responses + daily_tracker_responses)
      - SELECT * FROM tracker_events WHERE user_id = bucket.user_id

      # Tracker state projections (optional but recommended for fast UI)
      - SELECT * FROM tracker_state_entry WHERE user_id = bucket.user_id
      - SELECT * FROM tracker_state_day WHERE user_id = bucket.user_id

      # Checklist events (analytics history)
      - SELECT * FROM checklist_events WHERE user_id = bucket.user_id

