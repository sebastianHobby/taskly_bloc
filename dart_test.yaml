# Dart test configuration
# https://github.com/dart-lang/test/blob/master/pkgs/test/doc/configuration.md

# Global safety net - tests should complete well before this
timeout: 60s

# Test tags for selective execution
tags:
  # Unit tests - fast, isolated tests with mocks
  unit:
  
  # Integration tests - slower tests using real databases or multiple components
  integration:
    timeout: 60s
  
  # Widget tests - Flutter widget tests
  widget:
    timeout: 30s
  
  # Tests that are known to be slow
  slow:
    timeout: 120s

  # Known flaky tests (quarantined; excluded from default presets)
  flaky:
    timeout: 60s

  # Repository tests - database-backed tests
  repository:
    timeout: 60s

  # Auth tests - may have complex async flows
  auth:
    timeout: 30s
  
  # Tests for specific features
  analytics:
  reviews:
  journal:
  tasks:
  parity:

  # Local-stack pipeline tests (Supabase + PowerSync + real network)
  pipeline:
    timeout: 180s

  # Ad-hoc repro/diagnostics (not part of default presets)
  diagnosis:
    timeout: 60s

# Define test name patterns
presets:
  # Run only fast unit tests (for CI quick checks)
  fast:
    exclude-tags: [integration, slow, repository, flaky, pipeline, diagnosis]
    
  # Run integration tests only
  integration:
    include-tags: [integration]

  # Run repository tests only
  repository:
    include-tags: [repository]
    
  # Run all tests except slow ones
  quick:
    exclude-tags: [slow, flaky, pipeline, diagnosis]

  # Run all database-related tests
  database:
    include-tags: [integration, repository]

  # Run everything except local-stack pipeline tests
  no_pipeline:
    exclude-tags: [pipeline, diagnosis]

# Automatically apply tags based on file paths
on_os:
  windows:
  linux:
  mac-os:

# Test execution settings
concurrency: 4
reporter: expanded

# Also emit structured output to a file (in addition to stdout).
# See: https://github.com/dart-lang/test/blob/master/pkgs/test/doc/configuration.md#file_reporters
file_reporters:
  json: test/last_run.json

# Test retry configuration (for flaky tests)
# retry: 2

# Paths configuration - uncomment to customize
# paths:
#   - test/

# Exclude patterns (if needed)
# exclude:
#   - test/integration/**
